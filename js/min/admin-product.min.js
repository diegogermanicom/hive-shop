/**
 * @author Diego Martín
 * @copyright Hive®
 * @version 1.0
 * @lastUpdated 2025
 */
var ADMIN_PRODUCT={init:function(){this.productsEvent(),this.newProductEvents(),this.editProductEvents(),this.productsCustomRoutesEvents()},refreshCategoryList:function(e){var t="";$("#category-list-2 .list-item.active").each((function(){let a=parseInt($(this).attr("value"));checked=a==e?" checked":"",t+='<div class="list-item no-hover no-click" value="'+a+'">'+$(this).html(),t+='<label class="radio" for="category-'+a+'"><input type="radio" name="radio-category-list-1" id="category-'+a+'" value="'+a+'"'+checked+'><span class="checkmark"></span></label>',t+="</div>"})),$("#category-list-1").html(t)},loadNewProductImagen:function(e){var t=e.name;let a=new FileReader;a.onload=function(e){if(e.total<=2e6){let a='<div class="item-image new-image" style="background-image: url('+e.target.result+');" image-name="'+t+'">';a+='<div class="item-image-buttons">',a+='<div class="btn-item-image-delete"><i class="fa-solid fa-trash-can"></i> Delete</div>',a+="</div>",a+="</div>",$("#upload-images").append(a),$("#upload-images .new-image .btn-item-image-delete").off().on("click",(function(){$(this).closest(".item-image").remove()}))}else UTILS.showInfo("Error","Image size cannot be larger than 5 mb.")},a.readAsDataURL(e)},editProductRelatedEvents:function(){$(".btn-delete-related").off().on("click",(function(){var e=$(this),t={id_product_related:parseInt(e.attr("id-product-related"))};e.hasClass("disabled")||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/delete-related",data:t,success:function(t){"ok"==t.delete_related.response?1==$("#products-related tbody > tr").length?$("#products-related").html("No related products"):(null!=t.delete_related.id_main&&$('#products-related input[value="'+t.delete_related.id_main+'"]').prop("checked",!0),e.closest("tr").remove()):UTILS.showInfo("Uups","An unexpected error has occurred.<br>Reload the page to try again."),e.removeClass("disabled")}}))})),$(".btn-edit-related").on("click",(function(){var e=$(this),t={id_product_related:parseInt(e.attr("id-product-related"))};e.hasClass("disabled")||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/get-edit-related",data:t,success:function(a){"ok"==a.get_edit_related.response&&($("#popup-edit-related .content-related").html(a.get_edit_related.html),$("#btn-save-edit-related").attr("id-product-related",t.id_product_related),$("#popup-edit-related .content-images .item-image").on("click",(function(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected")})),UTILS.showPopup("#popup-edit-related")),e.removeClass("disabled")}}))}))},getRelated:function(e){var t=this,a={id_product:e};$.ajax({url:ADMIN_PATH+"/get-related",data:a,success:function(e){"ok"==e.get_related.response&&($("#products-related").html(e.get_related.html),t.editProductRelatedEvents())}})},getProductImages:function(e){var t=this,a={id_product:e};$.ajax({url:ADMIN_PATH+"/get-product-images",data:a,success:function(a){"ok"==a.get_product_images.response&&($("#upload-images").html(a.get_product_images.html),$("#upload-images .item-image .btn-item-image-delete").on("click",(function(){let e=$(this).closest(".item-image");$("#popup-delete-image").attr("id-product-image",e.attr("id-product-image")),$("#popup-delete-image").attr("id-image",e.attr("id-image")),UTILS.showPopup("#popup-delete-image")})),$("#upload-images .btn-item-image-main").on("click",(function(){var a=$(this);let s=$(this).closest(".item-image");var i={id_product:e,id_product_image:parseInt(s.attr("id-product-image"))};a.hasClass("disabled")||($("#upload-images .btn-item-image-main").addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-product-main-image",data:i,success:function(a){"ok"==a.save_product_main_image.response&&(t.getProductImages(e),UTILS.showInfo("Correct!",a.save_product_main_image.message)),$("#upload-images .btn-item-image-main").removeClass("disabled")}}))})),$("#upload-images .btn-item-image-hover").on("click",(function(){var a=$(this);let s=$(this).closest(".item-image");var i={id_product:e,id_product_image:parseInt(s.attr("id-product-image"))};a.hasClass("disabled")||($("#upload-images .btn-item-image-hover").addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-product-hover-image",data:i,success:function(a){"ok"==a.save_product_hover_image.response&&(t.getProductImages(e),UTILS.showInfo("Correct!",a.save_product_hover_image.message)),$("#upload-images .btn-item-image-hover").removeClass("disabled")}}))})))}})},objSaveEditProduct:function(){var e={id_product:null,alias:$("#input-name").val().trim(),price:$("#input-price").val().trim(),weight:$("#input-weight").val().trim(),id_tax_type:parseInt($("#select-tax").val()),id_view:parseInt($("#select-view").val()),id_state:parseInt($("#select-state").val()),categories:[],main_category:0,attributes:[],properties:[],meta_data:[],images:[],id_related_main:null};return $("#category-list-1 .list-item").each((function(){e.categories.push(parseInt($(this).attr("value")))})),e.main_category=parseInt($('input[name="radio-category-list-1"]:checked').val()),$("#attribute-list-1 .list-item").each((function(){e.attributes.push(parseInt($(this).attr("value")))})),$("#properties .menu > div").each((function(){let t=$(this).attr("id-tab"),a=$(this).closest("#properties").find('.content > div[id-tab="'+t+'"]'),s={id_lang:parseInt($(this).attr("id-lang")),name:$(a).find(".input-language-name").val().trim(),slug:$(a).find(".input-language-slug").val().trim(),description:$(a).find(".textarea-language-description").val().trim()};e.properties.push(s)})),$("#meta_data .menu > div").each((function(){let t=$(this).attr("id-tab"),a=$(this).closest("#meta_data").find('.content > div[id-tab="'+t+'"]'),s={id_lang:parseInt($(this).attr("id-lang")),meta_title:$(a).find(".input-language-meta-title").val().trim(),meta_keywords:$(a).find(".input-language-meta-keywords").val().trim(),meta_description:$(a).find(".textarea-language-meta-description").val().trim()};e.meta_data.push(s)})),$("#upload-images .item-image").each((function(){if($(this).hasClass("new-image"))if(null==$(this).attr("id-image")){let t=$(this).css("background-image");t=t.substring(5);let a={type:"explorer",data:t.substring(0,t.length-2),name:$(this).attr("image-name")};e.images.push(a)}else{let t={type:"server",id_image:$(this).attr("id-image")};e.images.push(t)}else{let t={type:"product",id_product_image:$(this).attr("id-product-image")};e.images.push(t)}})),e},productsEvent:function(){1==$("body#admin-products-page").length&&$(".btn-delete-product").on("click",(function(){var e=$(this),t={id_product:parseInt(e.attr("id-product"))};e.hasClass("disabled")||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/delete-product",data:t,success:function(t){"ok"==t.delete_product.response?1==$("#products-content tbody > tr").length?$("#products-content").html("No products"):e.closest("tr").remove():UTILS.showInfo("Uups","An unexpected error has occurred.<br>Reload the page to try again."),e.removeClass("disabled")}}))}))},newProductEvents:function(){if(1==$("body#admin-new-product-page").length){var e=this;$("#attribute-list-1").sortable({group:"list",animation:200,ghostClass:"ghost"}),$("#upload-images").sortable({group:"list",animation:200,ghostClass:"ghost"}),$("#category-list-2 .list-item").on("click",(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active");let t=parseInt($('input[name="radio-category-list-1"]:checked').val());e.refreshCategoryList(t)})),$("#attribute-list-2 .list-item").on("click",(function(){let e=$(this).attr("value");if($(this).hasClass("active"))$(this).removeClass("active"),$('#attribute-list-1 .list-item[value="'+e+'"]').remove();else{let t='<div class="list-item no-hover" value="'+e+'">'+$(this).html()+"</div>";$("#attribute-list-1").append(t),$(this).addClass("active")}})),$("#input-file").on("change",(function(){let t=["image/jpg","image/jpeg","image/png"];if(this.files){if(this.files.length<=10)for(i=0;i<this.files.length;i++)t.includes(this.files[i].type)&&e.loadNewProductImagen(this.files[i]);else UTILS.showInfo("Uups","You can only upload a maximum of 10 files.");this.value=""}})),$("#btn-save-new-product").on("click",(function(){var t=$(this),a=e.objSaveEditProduct();$(".content-new-product *").removeClass("error"),UTILS.validate("min-char-3",a.alias)||$("#input-name").addClass("error"),UTILS.validate("price",a.price)&&0!=a.price||$("#input-price").addClass("error"),UTILS.validate("weight",a.weight)&&0!=a.weight||$("#input-weight").addClass("error"),0==a.categories.length&&$("#category-list-1").addClass("error"),Number.isInteger(a.main_category)||$("#category-list-1").addClass("error"),t.hasClass("disabled")||0!=$(".content-new-product .error").length||(t.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-new-product",data:a,success:function(e){"ok"==e.save_new_product.response?(t.addClass("btn-ok"),window.location.href=ADMIN_PATH+"/products?new"):(UTILS.showInfo("Error",e.save_new_product.message),t.removeClass("disabled"))}}))}))}},editProductEvents:function(){if(1==$("body#admin-edit-product-page").length){var e=this;let t=parseInt($("#input-id-product").val());e.getRelated(t),e.getProductImages(t),$("#attribute-list-1").sortable({group:"list",animation:200,ghostClass:"ghost"}),$("#upload-images").sortable({group:"list",animation:200,ghostClass:"ghost"});let a=parseInt($("#category-list-2 .list-item.main").attr("value"));$("#category-list-2 .list-item.main").removeClass("main"),e.refreshCategoryList(a),$("#category-list-2 .list-item").on("click",(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active");let t=parseInt($('input[name="radio-category-list-1"]:checked').val());e.refreshCategoryList(t)})),$("#attribute-list-2 .list-item").on("click",(function(){let e=parseInt($(this).attr("value"));if($(this).hasClass("active"))$(this).removeClass("active"),$('#attribute-list-1 .list-item[value="'+e+'"]').remove();else{let t='<div class="list-item no-hover" value="'+e+'">'+$(this).html()+"</div>";$("#attribute-list-1").append(t),$(this).addClass("active")}})),$("#btn-delete-from-server-image").on("click",(function(){var t=$(this),a={id_image:parseInt(t.closest(".popup").attr("id-image"))};t.hasClass("disabled")||(t.closest(".popup").find(".btn").addClass("disabled"),$.ajax({url:ADMIN_PATH+"/delete-server-image",data:a,success:function(a){if("ok"==a.delete_product_server_image.response){let t=parseInt($("#input-id-product").val());e.getProductImages(t),UTILS.closePopup("#popup-delete-image")}else UTILS.showInfo("Uups","An unexpected error has occurred.<br>Reload the page to try again.");t.closest(".popup").find(".btn").removeClass("disabled")}}))})),$("#btn-delete-just-product-image").on("click",(function(){var t=$(this),a={id_product_image:parseInt(t.closest(".popup").attr("id-product-image")),id_product:parseInt($("#input-id-product").val())};t.hasClass("disabled")||(t.closest(".popup").find(".btn").addClass("disabled"),$.ajax({url:ADMIN_PATH+"/delete-product-image",data:a,success:function(s){"ok"==s.delete_product_image.response?(e.getProductImages(a.id_product),UTILS.closePopup("#popup-delete-image")):UTILS.showInfo("Uups","An unexpected error has occurred.<br>Reload the page to try again."),t.closest(".popup").find(".btn").removeClass("disabled")}}))})),$("#btn-open-popup-add-image").on("click",(function(){var e=$(this),t={id_product:parseInt($("#input-id-product").val())};e.hasClass("disabled")||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/get-add-images",data:t,success:function(t){"ok"==t.images.response?($("#popup-add-image .content-images").html(t.images.html),$("#popup-add-image .item-image .image").on("click",(function(){$(this).parent().hasClass("selected")?$(this).parent().removeClass("selected"):$(this).parent().addClass("selected")})),UTILS.showPopup("#popup-add-image")):UTILS.showInfo("Uups","An unexpected error has occurred.<br>Reload the page to try again."),e.removeClass("disabled")}}))})),$("#btn-add-images").on("click",(function(){if(0!=$("#popup-add-image .item-image.selected").length){var e="";$("#popup-add-image .item-image.selected").each((function(){let t=parseInt($(this).attr("id-image"));e+='<div class="item-image new-image" style="background-image: url('+$(this).attr("url")+');" id-image="'+t+'">',e+='<div class="item-image-buttons">',e+='<div class="btn-item-image-delete"><i class="fa-solid fa-trash-can"></i> Delete</div>',e+="</div>",e+="</div>"})),$("#upload-images").append(e),$("#upload-images .new-image .btn-item-image-delete").off().on("click",(function(){$(this).closest(".item-image").remove()})),UTILS.closePopup("#popup-add-image")}})),$("#input-file").on("change",(function(){let t=["image/jpg","image/jpeg","image/png"];if(this.files){if(this.files.length<=10)for(i=0;i<this.files.length;i++)t.includes(this.files[i].type)&&e.loadNewProductImagen(this.files[i]);else UTILS.showInfo("Uups","You can only upload a maximum of 10 files.");this.value=""}})),$("#btn-open-popup-add-related").on("click",(function(){var e=$(this),t={id_product:parseInt($("#input-id-product").val())};e.hasClass("disabled")||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/get-add-related",data:t,success:function(t){"ok"==t.get_add_related.response?($("#popup-add-related .content-related").html(t.get_add_related.html),$("#popup-add-related .content-images .item-image").on("click",(function(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected")})),UTILS.showPopup("#popup-add-related")):UTILS.showInfo("Uups","An unexpected error has occurred.<br>Reload the page to try again."),e.removeClass("disabled")}}))})),$("#btn-add-related").on("click",(function(){var t=$(this),a={id_product:parseInt($("#input-id-product").val()),attributes:[],stock:$("#input-add-related-stock").val().trim(),price_change:$("#input-add-related-price-change").val().trim(),weight_change:$("#input-add-related-weight-change").val().trim(),id_state:parseInt($("#select-add-related-state").val()),images:[]};$("#popup-add-related .content-attributes .item-attribute").each((function(){let e={id_attribute:parseInt($(this).attr("id-attribute")),id_value:parseInt($(this).find("select").val())};a.attributes.push(e)})),$("#popup-add-related .content-images .item-image.selected").each((function(){a.images.push($(this).attr("id-product-image"))})),UTILS.validate("number",a.stock)?a.stock=parseInt(a.stock):$("#input-add-related-stock").addClass("error"),UTILS.validate("price-negative",a.price_change)||$("#input-add-related-price-change").addClass("error"),UTILS.validate("weight-negative",a.weight_change)||$("#input-add-related-weight-change").addClass("error"),t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/add-related",data:a,success:function(a){"ok"==a.add_related.response?(0!=$("#products-related table").length?$("#products-related tbody").append(a.add_related.html):$("#products-related").html(a.add_related.html),e.editProductRelatedEvents(),UTILS.closePopup("#popup-add-related")):UTILS.showInfo("Uups",a.add_related.message),t.removeClass("disabled")}}))})),$("#btn-save-edit-related").on("click",(function(){var t=$(this),a={id_product_related:parseInt(t.attr("id-product-related")),stock:$("#input-edit-related-stock").val().trim(),price_change:$("#input-edit-related-price-change").val().trim(),weight_change:$("#input-edit-related-weight-change").val().trim(),id_state:parseInt($("#select-edit-related-state").val()),offer:$("#input-edit-related-offer").val().trim(),offer_start:$("#input-edit-related-offer-start-date").val().trim(),offer_end:$("#input-edit-related-offer-end-date").val().trim(),images:[]};$("#popup-edit-related .content-images .item-image.selected").each((function(){a.images.push($(this).attr("id-product-image"))})),$("#popup-edit-related *").removeClass("error"),UTILS.validate("number",a.stock)?a.stock=parseInt(a.stock):$("#input-edit-related-stock").addClass("error"),UTILS.validate("price-negative",a.price_change)||$("#input-edit-related-price-change").addClass("error"),UTILS.validate("weight-negative",a.weight_change)||$("#input-edit-related-weight-change").addClass("error"),UTILS.validate("price",a.offer)||$("#input-edit-related-offer").addClass("error"),0!=a.offer&&(UTILS.validate("date",a.offer_start)||$("#input-edit-related-offer-start-date").addClass("error"),UTILS.validate("date",a.offer_end)||$("#input-edit-related-offer-end-date").addClass("error")),t.hasClass("disabled")||0!=$("#popup-edit-related .error").length||(t.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-related",data:a,success:function(a){if("ok"==a.save_related.response){let t=parseInt($("#input-id-product").val());e.getRelated(t),UTILS.showInfo("Correct!",a.save_related.message)}t.removeClass("disabled")}}))})),$("#btn-save-product").on("click",(function(){var t=$(this),a=e.objSaveEditProduct();a.id_product=parseInt($("#input-id-product").val()),null!=$('input[name="input-related-main"]:checked').val()&&(a.id_related_main=parseInt($('input[name="input-related-main"]:checked').val())),$(".content-edit-product *").removeClass("error"),UTILS.validate("min-char-3",a.alias)||$("#input-name").addClass("error"),UTILS.validate("price",a.price)&&0!=a.price||$("#input-price").addClass("error"),UTILS.validate("weight",a.weight)&&0!=a.weight||$("#input-weight").addClass("error"),0==a.categories.length&&$("#category-list-1").addClass("error"),Number.isInteger(a.main_category)||$("#category-list-1").addClass("error"),t.hasClass("disabled")||0!=$(".content-edit-product .error").length||(t.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-edit-product",data:a,success:function(a){if("ok"==a.save_edit_product.response){UTILS.showInfo("Correct!",a.save_edit_product.message);let t=parseInt($("#input-id-product").val());e.getProductImages(t)}else UTILS.showInfo("Error",a.save_edit_product.message);t.removeClass("disabled")}}))}))}},productsCustomRoutesEvents:function(){1==$("body#admin-products-custom-routes-page").length&&($("#open-popup-new-product-custom-route").on("click",(function(){$("#products-list").val(0),$("#categories-list").html(""),$("#categories-list").addClass("hidden"),$("#languages-content input").val(""),$("#languages-content").addClass("hidden"),UTILS.showPopup("#popup-new-product-custom-route")})),$("#products-list").on("change",(function(){var e=$(this),t={id_product:parseInt($("#products-list").val())};e.hasClass("disabled")||(e.addClass("disabled"),$("#categories-list").html(""),$.ajax({url:ADMIN_PATH+"/get-product-categories-list",data:t,success:function(t){if("ok"==t.get_product_categories_list.response){let e='<option value="0">Select a category...</option>';e+=t.get_product_categories_list.html,$("#categories-list").html(e),$("#categories-list").removeClass("hidden")}e.removeClass("disabled")}}))})),$("#categories-list").on("change",(function(){$("#languages-content").removeClass("hidden")})),$("#btn-save-new-product-custom-route").on("click",(function(){var e=$(this),t={id_product:parseInt($("#products-list").val()),id_category:parseInt($("#categories-list").val()),routes:[]};$("#popup-new-product-custom-route *").removeClass("error"),$("#languages-content .item").each((function(){let e={id_language:parseInt($(this).attr("id-language")),route:$(this).find("input").val().trim()};UTILS.validate("slug",e.route)&&""!=e.route||$(this).find("input").addClass("error"),t.routes.push(e)})),0==t.id_product&&$("#products-list").addClass("error"),0==t.id_category&&$("#categories-list").addClass("error"),e.hasClass("disabled")||0!=$("#popup-new-product-custom-route .error").length||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-new-product-custom-route",data:t,success:function(t){"ok"==t.save_new_product_custom_route.response?(e.addClass("btn-ok"),window.location.href=ADMIN_PATH+"/products-custom-routes?new"):e.removeClass("disabled")}}))})),$(".btn-delete-product-custom-route").on("click",(function(){var e=$(this),t={id_product_custom_route:parseInt(e.attr("id-product-custom-route"))};e.hasClass("disabled")||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/delete-product-custom-route",data:t,success:function(t){"ok"==t.delete_product_custom_route.response?1==$("#products-custom-routes-content tbody > tr").length?$("#products-custom-routes-content").html("No products custom routes"):e.closest("tr").remove():UTILS.showInfo("Uups","An unexpected error has occurred.<br>Reload the page to try again."),e.removeClass("disabled")}}))})))}};$(window).ready((function(){ADMIN_PRODUCT.init()}));