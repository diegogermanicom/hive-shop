/**
 * @author Diego Martín
 * @copyright Hive®
 * @version 1.0
 * @lastUpdated 2025
 */
var ADMIN_TAX={init:function(){this.newEvents(),this.editEvents(),this.newZoneEvents(),this.editZoneEvents()},getZoneCountries:function(e,t=1){var n=this,a={id_tax_zone:parseInt($("#input-id-tax-zone").val()),id_continent:e,page:t};$.ajax({url:ADMIN_PATH+"/get-tax-zone-countries",data:a,success:function(t){"ok"==t.get_tax_zone_countries.response&&($("#tax-zone-countries").html(t.get_tax_zone_countries.html),$("#tax-zone-countries-pager").html(t.get_tax_zone_countries.pager),$("#tax-zone-countries-pager .btn").off().on("click",(function(){let t=$(this).data("page");n.getZoneCountries(e,t)})),n.checkAllInput("#tax-zone-countries"),$('#tax-zone-countries input[type="checkbox"]').off().on("click",(function(){n.checkAllInput("#tax-zone-countries")})))}})},getZoneProvinces:function(e,t=1){var n=this,a={id_tax_zone:parseInt($("#input-id-tax-zone").val()),id_country:e,page:t};$.ajax({url:ADMIN_PATH+"/get-tax-zone-provinces",data:a,success:function(t){"ok"==t.get_tax_zone_provinces.response&&($("#tax-zone-provinces").html(t.get_tax_zone_provinces.html),$("#tax-zone-provinces-pager").html(t.get_tax_zone_provinces.pager),$("#tax-zone-provinces-pager .btn").off().on("click",(function(){let t=$(this).data("page");n.getZoneProvinces(e,t)})),n.checkAllInput("#tax-zone-provinces"),$('#tax-zone-provinces input[type="checkbox"]').off().on("click",(function(){n.checkAllInput("#tax-zone-provinces")})))}})},checkAllInput:function(e){var t=$(e).closest("div[id-tab]"),n=!0;$(e+' input[type="checkbox"]').each((function(){$(this).is(":checked")||(n=!1)})),t.find(".btn-select-all").prop("checked",n)},newEvents:function(){1==$("body#admin-new-tax-type-page").length&&$("#btn-save-new-tax-type").on("click",(function(){var e=$(this),t={name:$("#input-name").val().trim(),id_state:parseInt($("#select-state").val())},n=UTILS.validateForm("#form-new-tax-type");e.hasClass("disabled")||1!=n.response||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-new-tax-type",data:t,success:function(t){"ok"==t.save_new_tax_type.response?(e.addClass("btn-ok"),window.location.href=ADMIN_PATH+"/tax-types?new"):(s,UTILS.showInfo("Error",t.save_new_tax_type.message),e.removeClass("disabled"))}}))}))},editEvents:function(){1==$("body#admin-edit-tax-type-page").length&&($("#btn-delete-tax-type").on("click",(function(){var e=$(this),t={id_tax_type:parseInt($("#input-id-tax-type").val())};e.hasClass("disabled")||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/delete-tax-type",data:t,success:function(e){"ok"==e.delete_tax_type.response&&(window.location.href=ADMIN_PATH+"/tax-types?delete")}}))})),$("#btn-save-edit-tax-type").on("click",(function(){var e=$(this),t={id_tax_type:parseInt($("#input-id-tax-type").val()),name:$("#input-name").val().trim(),id_state:parseInt($("#select-state").val()),zones:[]};$("#tax-zones .tax-zone").each((function(){let e=$(this).find('input[type="checkbox"]').prop("checked")?1:0;var n={id_tax_zone:$(this).data("id-tax-zone"),active:e,percent:$(this).find('input[type="text"]').val().trim()};t.zones.push(n)}));var n=UTILS.validateForm("#form-edit-tax-type");e.hasClass("disabled")||1!=n.response||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-edit-tax-type",data:t,success:function(t){"ok"==t.save_edit_tax_type.response?UTILS.showInfo("Correct!",t.save_edit_tax_type.message):UTILS.showInfo("Error",t.save_edit_tax_type.message),e.removeClass("disabled")}}))})))},newZoneEvents:function(){1==$("body#admin-new-tax-zone-page").length&&$("#btn-save-new-tax-zone").on("click",(function(){var e=$(this),t={name:$("#input-name").val().trim(),id_state:parseInt($("#select-state").val())},n=UTILS.validateForm("#form-new-tax-zone");e.hasClass("disabled")||1!=n.response||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-new-tax-zone",data:t,success:function(t){"ok"==t.save_new_tax_zone.response?(e.addClass("btn-ok"),window.location.href=ADMIN_PATH+"/tax-zones?new"):(UTILS.showInfo("Error",t.save_new_tax_zone.message),e.removeClass("disabled"))}}))}))},editZoneEvents:function(){if(1==$("body#admin-edit-tax-zone-page").length){var e=this;this.getZoneCountries(0),this.getZoneProvinces(0),this.checkAllInput("#tax-zone-continents"),$('#tax-zone-continents input[type="checkbox"]').on("click",(function(){e.checkAllInput("#tax-zone-continents")})),$("#btn-select-all-continents").on("click",(function(){var e=$(this).prop("checked");$("#tax-zone-continents input").each((function(){$(this).prop("checked",e)}))})),$("#btn-select-all-countries").on("click",(function(){var e=$(this).prop("checked");$("#tax-zone-countries input").each((function(){$(this).prop("checked",e)}))})),$("#btn-select-all-provinces").on("click",(function(){var e=$(this).prop("checked");$("#tax-zone-provinces input").each((function(){$(this).prop("checked",e)}))})),$("#select-countries-continents").on("change",(function(){let t=parseInt($(this).val());e.getZoneCountries(t)})),$("#select-provinces-countries").on("change",(function(){let t=parseInt($(this).val());e.getZoneProvinces(t)})),$("#btn-delete-tax-zone").on("click",(function(){var e=$(this),t={id_tax_zone:parseInt($("#input-id-tax-zone").val())};e.hasClass("disabled")||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/delete-tax-zone",data:t,success:function(e){"ok"==e.delete_tax_zone.response&&(window.location.href=ADMIN_PATH+"/tax-zones?delete")}}))})),$("#btn-save-edit-tax-zone").on("click",(function(){var e=$(this),t={id_tax_zone:parseInt($("#input-id-tax-zone").val()),name:$("#input-name").val().trim(),id_state:parseInt($("#select-state").val()),continents:[],continents_add:[],countries:[],countries_add:[],provinces:[],provinces_add:[]};$("#tax-zone-continents input").each((function(){let e=parseInt($(this).val());0!=e&&(t.continents.push(e),$(this).prop("checked")&&t.continents_add.push(e))})),$("#tax-zone-countries input").each((function(){let e=parseInt($(this).val());0!=e&&(t.countries.push(e),$(this).prop("checked")&&t.countries_add.push(e))})),$("#tax-zone-provinces input").each((function(){let e=parseInt($(this).val());0!=e&&(t.provinces.push(e),$(this).prop("checked")&&t.provinces_add.push(e))}));var n=UTILS.validateForm("#form-edit-tax-zone");e.hasClass("disabled")||1!=n.response||(e.addClass("disabled"),$.ajax({url:ADMIN_PATH+"/save-edit-tax-zone",data:t,success:function(t){"ok"==t.save_edit_tax_zone.response?UTILS.showInfo("Correct!",t.save_edit_tax_zone.message):UTILS.showInfo("Error",t.save_edit_tax_zone.message),e.removeClass("disabled")}}))}))}}};$(window).ready((function(){ADMIN_TAX.init()}));